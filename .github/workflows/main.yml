name: Robot Framework CI/CD Demo

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  test-and-report:
    runs-on: ubuntu-latest
    # å¼ºåˆ¶åœ¨å®¹å™¨å†…è¿è¡Œ
    container:
      image: ppodgorsek/robot-framework:latest
      # å¿…é¡»ä»¥ root è¿è¡Œï¼Œå¦åˆ™ GitHub Action æ— æ³•åœ¨å®¹å™¨å†…åŒæ­¥ä»£ç å’Œå†™å…¥ç»“æžœ
      options: --user root

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Run Robot API Tests
        run: |
          # ç¡®ä¿åœ¨å½“å‰ä»£ç ç›®å½•ä¸‹æ‰§è¡Œ
          # ä½¿ç”¨ --outputdir æŒ‡å®šç»“æžœå­˜æ”¾ä½ç½®
          robot --outputdir results api_test.robot || echo "Tests failed, but proceeding to generate report..."

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./results
          publish_branch: gh-pages

      - name: Post Summary
        if: always()
        run: |
          echo "### ðŸš€ è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œå®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- æŠ¥å‘Šåœ°å€: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/report.html" >> $GITHUB_STEP_SUMMARY
