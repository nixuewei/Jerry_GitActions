name: Robot Framework CI/CD Demo

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  test-and-report:
    # è¿™é‡Œå›žåˆ°å®¿ä¸»æœºè¿è¡Œï¼Œå®¿ä¸»æœºè‡ªå¸¦ git
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Run Robot API Tests in Docker
        run: |
          # 1. åˆ›å»ºç»“æžœç›®å½•å¹¶è®¾ä¸º 777 æƒé™ï¼Œç¡®ä¿å®¹å™¨èƒ½å†™å…¥
          mkdir -p results
          chmod 777 results
          
          # 2. ä½¿ç”¨ docker run æŒ‚è½½å½“å‰ç›®å½•
          # ppodgorsek é•œåƒé»˜è®¤ä¼šè¿è¡Œ /opt/robotframework/tests ä¸‹çš„è„šæœ¬
          # å¹¶æŠŠç»“æžœè¾“å‡ºåˆ° /opt/robotframework/reports
          docker run --rm \
            -v $(pwd):/opt/robotframework/tests \
            -v $(pwd)/results:/opt/robotframework/reports \
            ppodgorsek/robot-framework:latest

      - name: Deploy to GitHub Pages
        if: always()
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./results
          publish_branch: gh-pages

      - name: Post Summary
        if: always()
        run: |
          echo "### ðŸš€ è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œå®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- æŠ¥å‘Šåœ°å€: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/report.html" >> $GITHUB_STEP_SUMMARY
